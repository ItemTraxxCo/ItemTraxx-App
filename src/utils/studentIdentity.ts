const CODENAME_PREFIXES = [
  "Nova",
  "Echo",
  "Atlas",
  "Pixel",
  "Orbit",
  "Scout",
  "Comet",
  "Lumen",
  "Aster",
  "Vivid",
  "Aero",
  "Blaze",
  "Cobalt",
  "Delta",
  "Ember",
  "Falcon",
  "Glint",
  "Helix",
  "Iris",
  "Jade",
  "Kodi",
  "Lynx",
  "Mosaic",
  "Nimbus",
  "Onyx",
  "Prism",
  "Quartz",
  "Raven",
  "Sol",
  "Tango",
  "Umber",
  "Vector",
  "Willow",
  "Xeno",
  "Yonder",
  "Zephyr",
  "Acorn",
  "Arrow",
  "Aspen",
  "Beacon",
  "Beryl",
  "Bloom",
  "Bolt",
  "Breeze",
  "Canyon",
  "Cinder",
  "Citrus",
  "Clover",
  "Coral",
  "Cosmo",
  "Crown",
  "Dawn",
  "Dazzle",
  "Dove",
  "Ember",
  "Ever",
  "Flare",
  "Frost",
  "Gale",
  "Gamma",
  "Glow",
  "Groove",
  "Halo",
  "Harbor",
  "Horizon",
  "Indigo",
  "Jet",
  "Juniper",
  "Kite",
  "Lagoon",
  "Laser",
  "Legend",
  "Lotus",
  "Lunar",
  "Mango",
  "Maple",
  "Marble",
  "Mercury",
  "Mint",
  "Monarch",
  "Morning",
  "Neon",
  "North",
  "Ocean",
  "Olive",
  "Opal",
  "Orchid",
  "Panda",
  "Pebble",
  "Pepper",
  "Photon",
  "Pioneer",
  "Pluto",
  "Polar",
  "Poppy",
  "Pulse",
  "Ranger",
  "Rocket",
  "Ruby",
  "Saffron",
  "Sail",
  "Satin",
  "Shadow",
  "Silver",
  "Sky",
  "Snow",
  "Solar",
  "Sonic",
  "Star",
  "Sunset",
  "Swift",
  "Terra",
  "Thunder",
  "Topaz",
  "Trail",
  "Twilight",
  "Ultra",
  "Velvet",
  "Vesper",
  "Voyage",
  "Whisper",
  "Wild",
  "Winter",
  "Zen",
  "Auric",
  "Boreal",
  "Cascade",
  "Cobalt",
  "Cipher",
  "Crimson",
  "Draco",
  "Emberly",
  "Fable",
  "Galaxy",
  "Haven",
  "Ion",
  "Krypton",
  "Lucid",
  "Mirage",
  "Noble",
  "Obsidian",
  "Parallax",
  "Radiant",
  "Sierra",
  "Tempest",
  "Unity",
  "Verdant",
  "Warden",
  "Yukon",
  "Zenith",
  "Aurora",
  "Brisk",
  "Cadence",
  "Dynamo",
  "Element",
  "Flux",
  "Garnet",
  "Helio",
  "Jovian",
  "Kepler",
  "Lattice",
  "Matrix",
  "Nexus",
  "Orion",
];

const CODENAME_SUFFIXES = [
  "Fox",
  "Pine",
  "Wave",
  "Maple",
  "River",
  "Spark",
  "Drift",
  "Cedar",
  "Birch",
  "Stone",
  "Oak",
  "Hill",
  "Trail",
  "Brook",
  "Field",
  "Grove",
  "Vale",
  "Summit",
  "Harbor",
  "Ridge",
  "Meadow",
  "Glade",
  "Bay",
  "Marsh",
  "Cliff",
  "Falls",
  "Haven",
  "Peak",
  "Dune",
  "Creek",
  "Forest",
  "Lake",
  "Shore",
  "Spruce",
  "Elm",
  "Sage",
  "Anchor",
  "Ash",
  "Aurora",
  "Bamboo",
  "Basin",
  "Bluff",
  "Boulder",
  "Branch",
  "Breeze",
  "Bridge",
  "Bright",
  "Canyon",
  "Cloud",
  "Coast",
  "Copper",
  "Cove",
  "Crane",
  "Creek",
  "Crest",
  "Crown",
  "Daisy",
  "Delta",
  "Diamond",
  "Dolphin",
  "Eagle",
  "East",
  "Ember",
  "Falcon",
  "Fern",
  "Fjord",
  "Flame",
  "Flight",
  "Flower",
  "Forest",
  "Frost",
  "Garden",
  "Glacier",
  "Glen",
  "Glimmer",
  "Gold",
  "Granite",
  "Grass",
  "Harbor",
  "Hawk",
  "Hollow",
  "Ice",
  "Island",
  "Ivory",
  "Jasper",
  "Jungle",
  "Lagoon",
  "Leaf",
  "Light",
  "Lily",
  "Lotus",
  "Moon",
  "Moss",
  "Mountain",
  "Night",
  "North",
  "Nova",
  "Oasis",
  "Ocean",
  "Orchid",
  "Path",
  "Petal",
  "Pillar",
  "Planet",
  "Prairie",
  "Quartz",
  "Rain",
  "Raven",
  "Reef",
  "River",
  "Root",
  "Sail",
  "Sand",
  "Shine",
  "Sky",
  "Spring",
  "Star",
  "Stream",
  "Summit",
  "Sun",
  "Thorn",
  "Thunder",
  "Timber",
  "Torch",
  "Trail",
  "Tree",
  "Valley",
  "Violet",
  "Water",
  "West",
  "Wind",
  "Wing",
  "Wood",
  "Zen",
  "Arbor",
  "Badge",
  "Beacon",
  "Briar",
  "Canopy",
  "Cascade",
  "Chime",
  "Comet",
  "Compass",
  "Crescent",
  "Crossing",
  "Current",
  "Dawn",
  "Echo",
  "Ember",
  "Estuary",
  "Evergreen",
  "Flint",
  "Frontier",
  "Glow",
  "Grove",
  "Harbor",
  "Horizon",
  "Jetty",
  "Juniper",
  "Kernel",
  "Lantern",
  "Ledge",
  "Marina",
  "Moraine",
  "Nectar",
  "Nook",
  "Orchard",
  "Pass",
  "Pond",
  "Port",
  "Quarry",
  "Raptor",
  "Rift",
  "Roost",
  "Signal",
  "Sound",
  "Spire",
  "Station",
  "Tide",
  "Vista",
  "Wharf",
  "Yard",
  "Yarrow",
  "Zeal",
];

const secureRandomInt = (maxExclusive: number): number => {
  if (!Number.isInteger(maxExclusive) || maxExclusive <= 0) {
    throw new Error("maxExclusive must be a positive integer");
  }
  const uint32Range = 0x1_0000_0000;
  const maxAllowed = Math.floor(uint32Range / maxExclusive) * maxExclusive;
  const buffer = new Uint32Array(1);
  while (true) {
    crypto.getRandomValues(buffer);
    const value = buffer[0] ?? 0;
    if (value < maxAllowed) {
      return value % maxExclusive;
    }
  }
};

const randomDigits = (len: number) =>
  Array.from({ length: len }, () => secureRandomInt(10)).join("");

const randomLetters = (len: number) =>
  Array.from({ length: len }, () =>
    String.fromCharCode(65 + secureRandomInt(26))
  ).join("");

export const generateStudentId = () => `${randomDigits(4)}${randomLetters(2)}`;

export const generateStudentUsername = () => {
  const prefix =
    CODENAME_PREFIXES[secureRandomInt(CODENAME_PREFIXES.length)];
  const suffix =
    CODENAME_SUFFIXES[secureRandomInt(CODENAME_SUFFIXES.length)];
  return `${prefix}${suffix}${randomLetters(2)}${randomDigits(4)}`;
};

export const generateStudentIdentity = () => ({
  username: generateStudentUsername(),
  studentId: generateStudentId(),
});
